<!DOCTYPE html>
<html>
<head>
	<title>Calculo de la letra del DNI - JS</title>
    <meta charset="UTF-8">
    <meta name="description" content="Ejercicios de JavaScript">
    <meta name="author" content="Alejandro">
    <link rel="shortcut icon" href="fav_icon.png">
    <link rel="stylesheet" href="javascript_001.css">
	<script type="text/javascript">

        function main() {
            const Q1 = "Introduce tu número de DNI (con su letra y sin espacios)";
            var mensajes = [
                "El número de DNI y su letra son correctos",
                "El número proporcionado no es válido",
                'La letra no corresponde al número proporcionado',
                'El texto escrito no corresponde al formado de un DNI'
            ]                
            var letras = ['T', 'R', 'W', 'A', 'G', 'M', 'Y', 'F', 'P', 'D', 'X', 'B', 'N',
            'J', 'Z', 'S', 'Q', 'V', 'H', 'L', 'C', 'K', 'E', 'T'];

            var regDNI = /^\d{0,2}.?\d{0,3}.?\d{1,3}-?[A-Za-z]$/

            try{
                calculaDNI(prompt(Q1));
            }
            catch (err) {
                if (typeof err == "object") {
                    document.write(err.message);
                }
                else {
                    document.write(err);
                }
                console.dir(err);
                return;
            }
            
            document.write(mensajes[0]);
            

            function calculaDNI(cDNI) {

                //Comprobar DNI
                if (!regDNI.test(cDNI)) {
                    throw new Error(mensajes[3]); // eror formato
                }

                // Eliminar los espacios en blanco 
                cDNI = cDNI.replace(/ /g, "");
                // Eliminar los guiones 
                cDNI = cDNI.replace(/-+/g, "");
                // Eliminar los puntos usando una Expresion Regular
                cDNI = cDNI.replace(/\./g, "");

                //quitamos el último caracter
                var numero = cDNI.substring(0, cDNI.length - 1);
                // comprobamos que nos queda solo un número
                //if (parseInt(numero) != numero) {
                //    throw mensajes[3]; // eror formato
                //}
                // recuperamos el último caracter como letra
                var letra = cDNI.substring(cDNI.length - 1, cDNI.length);
                // convertimos la letra a mayúsculas
                letra = letra.toUpperCase();

                if (numero < 0 || numero > 99999999) {
                    throw mensajes[1]; // eror en el numero
                } else {
                    if (letras[numero % 23] != letra.toUpperCase()) {
                        throw mensajes[2];  // error en la letra
                    } else {
                        return 0;
                    }
                } // Fin del if
            }; // Fin de la función calculaDNI() 

        }; // Fin de la función main()
	</script>
</head>

<body>
	<p>Esta página calcula la letra del DNI</p>
    <p>
        <script>
            main();
        </script>
    </p>
</body>
</html>